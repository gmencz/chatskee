fragment Message on messages {
  content
  guest_id
  guest_name
  timestamp
  nonce
}

query LatestMessages {
  messages(order_by: { timestamp: asc }) {
    ...Message
  }
}

subscription OnNewMessage {
  messages(limit: 1, order_by: { timestamp: desc }) {
    nonce
    timestamp
  }
}

mutation NewMessage($input: messages_insert_input!) {
  insert_messages_one(object: $input) {
    nonce
    timestamp
  }
}

mutation SendMessage($input: SendMessageInput!) {
  sendMessage(input: $input) {
    message_id
    message {
      ...Message
    }
  }
}

query MessagesRange($from: timestamptz, $to: timestamptz) {
  messages(
    where: { timestamp: { _gt: $from, _lte: $to } }
    order_by: { timestamp: asc }
  ) {
    ...Message
  }
}

mutation ClearMessages {
  delete_messages(where: {}) {
    affected_rows
  }
}
